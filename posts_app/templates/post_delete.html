{% extends 'base.html' %}

{% block content %}
<!-- Botão para abrir o Modal -->
<button type="button" class="btn btn-danger" id="deletePostButton">
  Deletar Postagem
</button>

<!-- Caixa de diálogo personalizada (modal) -->
<div id="deleteModal" class="delete-modal" style="display: none;">
  <div class="delete-modal-content">
    <h5>Você tem certeza que deseja deletar este post?</h5>
    <form method="post">
      {% csrf_token %}
      <button class="btn btn-danger" type="submit">Sim, Deletar</button>
    </form>
    <button class="btn btn-secondary" id="closeModalButton">Cancelar</button>
  </div>
</div>



<!-- Estilos do Modal -->
<style>
  .delete-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5); /* Fundo semitransparente */
    justify-content: center;
    align-items: center;
    z-index: 1000; /* Coloca o modal por cima de outros elementos */
  }

  .delete-modal-content {
    background-color: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
    max-width: 500px;
    width: 80%;
  }

  .btn {
    margin: 5px;
  }
</style>

<!-- Script para a lógica AJAX e Modal -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const deletePostButton = document.getElementById('deletePostButton');
    const deleteModal = document.getElementById('deleteModal');
    const closeModalButton = document.getElementById('closeModalButton');
    const deleteForm = document.getElementById('deleteForm');
    
    // Quando o botão "Deletar Postagem" for clicado, exibe o modal
    deletePostButton.addEventListener('click', function() {
      deleteModal.style.display = 'flex'; // Exibe o modal
    });

    // Quando o botão "Cancelar" for clicado, fecha o modal
    closeModalButton.addEventListener('click', function() {
      deleteModal.style.display = 'none'; // Esconde o modal
    });

    // Enviar a requisição para deletar via AJAX
    deleteForm.addEventListener('submit', function(event) {
      event.preventDefault(); // Impede o envio padrão do formulário
      const url = deleteForm.action;
      const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
      
      // Envia a solicitação AJAX
      fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': csrfToken
        },
        body: JSON.stringify({}) // Corpo vazio, pois a deleção será feita no servidor
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // Fechar o modal e talvez redirecionar ou atualizar a página
          deleteModal.style.display = 'none';
          // Aqui você pode redirecionar para a lista de posts ou algo similar
          window.location.href = '/'; // Redireciona para a página inicial (ou outra página)
        } else {
          alert('Erro ao deletar o post');
        }
      })
      .catch(error => {
        console.error('Erro ao deletar o post:', error);
      });
    });
  });
</script>

{% endblock %}